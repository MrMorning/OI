
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="-1">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="google-site-verification" content="OTd2dN5x4nS4OPknPI9JFg36fKxjqY0i1PSfFPv_J90"/>    
    <meta name="verify-reformal" content="f56f99fd7e087fb6ccb48ef2" />
    <title>Problem - 167E - Codeforces</title>
        <meta name="description" content="Codeforces. Programming competitions and contests, programming community" />
        <meta name="keywords" content="programming algorithm contest competition informatics olympiads c++ java graphs vkcup" />
    <meta name="robots" content="index, follow" />
    <HEAD><!--CombineResourcesFilter-->
    <LINK href="../../../../stat.codeforces.ru/favicon.png" rel="shortcut icon" type="image/png"/>
    <LINK href="../../../../stat.codeforces.ru/css/prettify.css" rel="stylesheet" type="text/css"/>
    <LINK charset="utf-8" href="../../../../codeforces.ru/static/combine/81d5459d81d074fc8d55b62d42856e2f_afb7247773e175c6194b5a4dbff89aeb.css" rel="stylesheet" type="text/css"/>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <LINK href="../../../../stat.codeforces.ru/markitup/skins/markitup/style.css" rel="stylesheet" type="text/css"/>
    <LINK href="../../../../stat.codeforces.ru/markitup/sets/markdown/style.css" rel="stylesheet" type="text/css"/>

    <SCRIPT charset="utf-8" src="../../../../yandex.st/share/share.js" type="text/javascript"> </SCRIPT>
    <LINK charset="utf-8" href="../../../../codeforces.ru/static/combine/eeae61f38a42b29407204616d93d8e8_aa3a566ac2a84e49a8e02f83d509fffe.css" rel="stylesheet" type="text/css"/>
    

    <!--[if IE]>
        <style>
            #sidebar {
                padding-left: 1em;
                margin: 1em 1em 1em 0;
            }
        </style>
    <![endif]-->
    
    <SCRIPT src="../../../../codeforces.ru/static/combine/92a6f5c66e500b5c1433eae7d3f371bb_5dc6637756ba9e44d6304b6267b72667.js" type="text/javascript"> </SCRIPT>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <!--/CombineResourcesFilter--></HEAD>
</head>
<body>


<!-- Copyright © 2008. Spidersoft Ltd -->
<style>
A.applink:hover {border: 2px dotted #DCE6F4;padding:2px;background-color:#ffff00;color:green;text-decoration:none}
A.applink       {border: 2px dotted #DCE6F4;padding:2px;color:#2F5BFF;background:transparent;text-decoration:none}
A.info          {color:#2F5BFF;background:transparent;text-decoration:none}
A.info:hover    {color:green;background:transparent;text-decoration:underline}
</style>
<div style='BORDER: 1px solid #DCE6F4; MARGIN-TOP: 20px; MARGIN-BOTTOM: 20px; MARGIN-LEFT: 5px; MARGIN-RIGHT: 5px; PADDING: 5px; BACKGROUND-COLOR: #eef8ff;line-height:180%; COLOR: #000000; font-family: Arial; font-size: 8pt; width=100%; FILTER: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr="#FFFFFFFF", EndColorStr="#F2F5FAFF");'>
This page was saved using <a class="applink" href="http://www.spidersoft.com"><b>WebZIP 7.1.2.1052</b></a> <a class="applink" href="http://www.spidersoft.com"><b>offline browser</b></a>  (Unregistered) on  11/09/12 16:28:26.<br>
<b>Address:</b> <a class="info" href="http://codeforces.com/problemset/problem/167/E">http://codeforces.com/problemset/problem/167/E</a><br>
<b>Title:</b> Problem - 167E - Codeforces &nbsp;&bull;&nbsp; <b>Size:</b> 18294<br></div>
<!-- /Copyright © 2008. Spidersoft Ltd -->


<!-- Codeforces javascripts. -->

    <script type="text/javascript">
        $(document).ready(function() {
    window.updateTypography = function () {
        $("div.ttypography code").addClass("tt");
        $("div.ttypography pre>code").addClass("prettyprint").removeClass("tt");
        $("div.ttypography table").addClass("bordertable");
        prettyPrint();
    }

    $.ajaxSetup({ scriptCharset: "utf-8" ,contentType: "application/x-www-form-urlencoded; charset=UTF-8" });
    window.updateTypography();

    Codeforces.signForms();

    $(".second-level-menu-list").lavaLamp({
        fx: "backout",
        speed: 1000
    });


    Codeforces.countdown();
    $("a[rel='photobox']").colorbox();


        });
    </script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-743380-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<div id="body">

<div id="header" style="position:relative;">
    <div style="float:left;">
            <a href="http://codeforces.com/"><img src="../../../../stat.codeforces.ru/images/codeforces-logo-with-upper-beta.png"/></a>
            <div style="position:absolute;left:147px;top:41px;">
                <a href="http://vk.com/" class="logo-href">Sponsored by <img style="position:relative;top:2px;" src="../../../../stat.codeforces.ru/images/vkontakte-tiny-en.png"/></a>
            </div>
    </div>
    <div class="lang-chooser">
        <div style="text-align: right;">
            <a href="http://codeforces.com/problemset/problem/167/?locale=en"><img src="../../../../stat.codeforces.ru/images/flags/24/gb.png" title="In English" alt="In English"/></a>
            <a href="http://codeforces.com/problemset/problem/167/?locale=ru"><img src="../../../../stat.codeforces.ru/images/flags/24/ru.png" title="ÐŸÐ¾-Ñ€ÑƒÑÑÐºÐ¸" alt="ÐŸÐ¾-Ñ€ÑƒÑÑÐºÐ¸"/></a>
        </div>
        <div>
                <a href="http://codeforces.com/enter">Enter</a>
                 | 
                <a href="http://codeforces.com/register">Register</a>
                
        </div>
    </div>
    <div style="font-size:0.8em;margin-top:0.25em;position:absolute;right:0;top:4.25em;">
    </div>
    <br style="clear: both;"/>
</div>

    <div class="roundbox menu-box" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
            <div class="menu-list-container">

<ul class="menu-list">
        <li class=""><a href="http://codeforces.com/">Home</a></li>
        <li class=""><a href="http://codeforces.com/contests">Contests</a></li>
        <li class=""><a href="http://codeforces.com/gyms">Gym</a></li>
        <li class="current"><a href="http://codeforces.com/problemset">Problemset</a></li>
        <li class=""><a href="http://codeforces.com/ratings">Rating</a></li>
        <li class=""><a href="http://codeforces.com/help">FAQ</a></li>
        <li class=""><a href="http://codeforces.com/croc2012">CROC 2012 <img class="icon" src="../../../../stat.codeforces.ru/images/icons/cup.png"/></a></li>
        <li class=""><a href="http://codeforces.com/bayan201213">Bayan 2012/13 <img class="icon" src="../../../../stat.codeforces.ru/images/icons/cup.png"/></a></li>
        <li class=""><a href="http://codeforces.com/croc-bmstu-2012">CROC-MBTU 2012 <img class="icon" src="../../../../stat.codeforces.ru/images/icons/cup.png"/></a></li>
</ul>
                <form action="/search">
                    <input class="search" name="query" value="Search by tag..."/>
                </form>
                <br style="clear: both;"/>
            </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $("input.search").focus(function() {
                var val = $(this).val();
                if (val.indexOf("...") > 0) {
                    $(this).val("");
                }
            });
        });
    </script>
        <br style="height:3em; clear: both;"/>
        <div style="position: relative;">
                <div id="sidebar">

    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <table class="rtable">
            <tbody>
                <tr>
                            <th class="left" style="width:100%;">Codeforces Round #114 (Div. 1)</th>
                </tr>
                    <tr>
                                <td class="left  dark" colspan="1"><span class='contest-state-phase'>Finished</span></td>
                    </tr>
                    <tr>
                                <td class="left bottom" colspan="1"><span class='contest-state-regular countdown' home='http://stat.codeforces.ru' noRedirection='true' textBeforeRedirect=''><center>
</center></span></td>
                    </tr>
            </tbody>
        </table>
    </div>


    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <div class="caption titled">&rarr; Problem tags
            <div class="top-links">
            </div>
        </div>
<div style="padding: 0.5em;">
    <div class="roundbox " style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
<span class="tag-box" style="font-size:12px;" title="Mathematics including integration, differential equations, etc">
    math
</span>
    </div>
    <div class="roundbox " style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
<span class="tag-box" style="font-size:12px;" title="Matrix multiplication, determinant, Cramer's rule, systems of linear equations">
    matrices
</span>
    </div>
    <div style="clear:both;text-align:right;font-size:11px;">
            <span title="Please login into the Codeforces" class="notice">No tag edit access</span>
    </div>
</div>
    </div>

<form id="addTagForm" action="/data/problemTags" method="post" style="display:none;">
    <input name="action" type="hidden" value="addTag"/>
    <input name="problemId" type="hidden" value="1064"/>
    <input name="tagName" type="hidden" value=""/>
</form>

<form id="removeTagForm" action="/data/problemTags" method="post" style="display:none;">
    <input name="action" type="hidden" value="removeTag"/>
    <input name="problemId" type="hidden" value="1064"/>
    <input name="tagName" type="hidden" value=""/>
</form>

<script type="text/javascript">
    $(".tag-box img").click(function () {
        var tagName = $(this).attr("value");
        Codeforces.confirm("Are you sure you want to remove this tag?", function () {
            $("#removeTagForm input[name=tagName]").val(tagName);
            $("#removeTagForm").submit();
        }, function () {
        }, "Yes", "No");
    });

    $("#addTagLink").click(function () {
        $(this).hide();
        $("#addTagLabel").show();
        return false;
    });

    $("#addTagSelect").change(function () {
        var tagName = $(this).val();
        if (tagName === "") {
            $("#addTagLabel").hide();
            $("#addTagLink").show();
        } else {
            $("#addTagForm input[name=tagName]").val(tagName);
            $("#addTagForm").submit();
        }
    });
</script>

                </div>
                <div id="content" class="content-with-sidebar">
                <div class="second-level-menu">
<ul class="second-level-menu-list">
    <li class="current"><a href="http://codeforces.com/problemset">Problems</a></li>
    <li><a href="http://codeforces.com/problemset/submit">Submit</a></li>
    <li><a href="http://codeforces.com/problemset/status">Status</a></li>
    <li><a href="http://codeforces.com/problemset/standings">Standings</a></li>
    <li><a href="http://codeforces.com/problemset/customtest">Custom test</a></li>
</ul>
</div>

<div class="ttypography"><div class="problem-statement"><div class="header"><div class="title">E. Wizards and Bets</div><div class="time-limit"><div class="property-title">time limit per test</div>3 seconds</div><div class="memory-limit"><div class="property-title">memory limit per test</div>256 megabytes</div><div class="input-file"><div class="property-title">input</div>standard input</div><div class="output-file"><div class="property-title">output</div>standard output</div></div><div><p>In some country live wizards. They like to make weird bets.</p><p>Two wizards draw an acyclic directed graph with <span class="tex-span"><i>n</i></span> vertices and <span class="tex-span"><i>m</i></span> edges (the graph's vertices are numbered from <span class="tex-span">1</span> to <span class="tex-span"><i>n</i></span>). A <span class="tex-font-style-it">source</span> is a vertex with no incoming edges, and a <span class="tex-font-style-it">sink</span> is the vertex with no outgoing edges. Note that a vertex could be the sink and the source simultaneously. In the wizards' graph the number of the sinks and the sources is the same.</p><p>Wizards numbered the sources in the order of increasing numbers of the vertices from <span class="tex-span">1</span> to <span class="tex-span"><i>k</i></span>. The sinks are numbered from <span class="tex-span">1</span> to <span class="tex-span"><i>k</i></span> in the similar way.</p><p>To make a bet, they, as are real wizards, cast a spell, which selects a set of <span class="tex-span"><i>k</i></span> paths from all sources to the sinks in such a way that no two paths intersect at the vertices. In this case, each sink has exactly one path going to it from exactly one source. Let's suppose that the <span class="tex-span"><i>i</i></span>-th sink has a path going to it from the <span class="tex-span"><i>a</i><sub class="lower-index"><i>i</i></sub></span>'s source. Then let's call pair <span class="tex-span">(<i>i</i>,â€‰<i>j</i>)</span> an <span class="tex-font-style-it">inversion</span> if <span class="tex-span"><i>i</i>â€‰&lt;â€‰<i>j</i></span> and <span class="tex-span"><i>a</i><sub class="lower-index"><i>i</i></sub>â€‰&gt;â€‰<i>a</i><sub class="lower-index"><i>j</i></sub></span>. If the number of inversions among all possible pairs <span class="tex-span">(<i>i</i>,â€‰<i>j</i>)</span>, such that <span class="tex-span">(1â€‰â‰¤â€‰<i>i</i>â€‰&lt;â€‰<i>j</i>â€‰â‰¤â€‰<i>k</i>)</span>, is even, then the first wizard wins (the second one gives him one magic coin). Otherwise, the second wizard wins (he gets one magic coin from the first one).</p><p>Our wizards are captured with feverish excitement, so they kept choosing new paths again and again for so long that eventually they have chosen every possible set of paths for exactly once. The two sets of non-intersecting pathes are considered to be different, if and only if there is an edge, which lies at some path in one set and doesn't lie at any path of another set. To check their notes, they asked you to count the total winnings of the first player for all possible sets of paths modulo a prime number <span class="tex-span"><i>p</i></span>.</p></div><div class="input-specification"><div class="section-title">Input</div><p>The first line contains three space-separated integers <span class="tex-span"><i>n</i></span>, <span class="tex-span"><i>m</i></span>, <span class="tex-span"><i>p</i></span> (<span class="tex-span">1â€‰â‰¤â€‰<i>n</i>â€‰â‰¤â€‰600</span>, <span class="tex-span">0â€‰â‰¤â€‰<i>m</i>â€‰â‰¤â€‰10<sup class="upper-index">5</sup></span>, <span class="tex-span">2â€‰â‰¤â€‰<i>p</i>â€‰â‰¤â€‰10<sup class="upper-index">9</sup>â€‰+â€‰7</span>). It is guaranteed that <span class="tex-span"><i>p</i></span> is prime number.</p><p>Next <span class="tex-span"><i>m</i></span> lines contain edges of the graph. Each line contains a pair of space-separated integers, <span class="tex-span"><i>a</i><sub class="lower-index"><i>i</i></sub>Â <i>b</i><sub class="lower-index"><i>i</i></sub></span> â€” an edge from vertex <span class="tex-span"><i>a</i><sub class="lower-index"><i>i</i></sub></span> to vertex <span class="tex-span"><i>b</i><sub class="lower-index"><i>i</i></sub></span>. It is guaranteed that the graph is acyclic and that the graph contains the same number of sources and sinks. Please note that the graph can have multiple edges.</p></div><div class="output-specification"><div class="section-title">Output</div><p>Print the answer to the problem â€” the total winnings of the first player modulo a prime number <span class="tex-span"><i>p</i></span>. Please note that the winnings may be negative, but the modulo residue must be non-negative (see the sample).</p></div><div class="sample-tests"><div class="section-title">Sample test(s)</div><div class="sample-test"><div class="input"><div class="title">Input</div><pre>4 2 1000003<br />1 3<br />2 4<br /></pre></div><div class="output"><div class="title">Output</div><pre>1<br /></pre></div><div class="input"><div class="title">Input</div><pre>4 2 1000003<br />4 1<br />3 2<br /></pre></div><div class="output"><div class="title">Output</div><pre>1000002<br /></pre></div><div class="input"><div class="title">Input</div><pre>4 4 1000003<br />2 1<br />2 4<br />3 1<br />3 4<br /></pre></div><div class="output"><div class="title">Output</div><pre>0<br /></pre></div><div class="input"><div class="title">Input</div><pre>6 5 1000003<br />1 4<br />1 5<br />1 6<br />2 6<br />3 6<br /></pre></div><div class="output"><div class="title">Output</div><pre>0<br /></pre></div><div class="input"><div class="title">Input</div><pre>5 2 1000003<br />5 1<br />3 4<br /></pre></div><div class="output"><div class="title">Output</div><pre>1<br /></pre></div></div></div><div class="note"><div class="section-title">Note</div><p>In the first sample, there is exactly one set of paths â€” <img align="middle" class="tex-formula" src="../../../../codeforces.ru/renderer/4c100300071b70505c9eb8fd6f97456068e38f93.png" />. The number of inversions is 0, which is an even number. Therefore, the first wizard gets 1 coin.</p><p>In the second sample there is exactly one set of paths â€” <img align="middle" class="tex-formula" src="../../../../codeforces.ru/renderer/83cf8c3e6763396a8ead42b4762ff62e4b01f917.png" />. There is exactly one inversion. Therefore, the first wizard gets -1 coin. <img align="middle" class="tex-formula" src="../../../../codeforces.ru/renderer/fa579688f149cd6ab8f4c3c99c47c5a65e52e87c.png" />.</p><p>In the third sample, there are two sets of paths, which are counted with opposite signs.</p><p>In the fourth sample there are no set of paths at all.</p><p>In the fifth sample, there are three sources â€” the vertices with the numbers (2, 3, 5) and three sinks â€” the vertices with numbers (1, 2, 4). For a single set of paths <img align="middle" class="tex-formula" src="../../../../codeforces.ru/renderer/5ef1a2c8d476f3fea4b49124c0c23f371be35bb9.png" /> are 2 inversions, that is, their number is <span class="tex-font-style-bf">even</span>.</p></div></div></div>            </div>
        </div>
          <br style="clear:both;"/> 
          <div id="footer">
               <div><a href="http://codeforces.com/">Codeforces</a> (c) Copyright 2010-2012 Mike Mirzayanov</div>
               <div>The only programming contests Web 2.0 platform</div>
               
               <div>Server time: 11/09/2012 12:27PM.</div>
          </div>
    <script type="text/javascript">
        $(document).ready(function() {
            Codeforces.focusOnError();
        });
    </script>
</div>    
</body>                                       
</html>                                       
