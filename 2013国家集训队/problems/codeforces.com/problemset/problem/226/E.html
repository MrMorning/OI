
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="-1">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="google-site-verification" content="OTd2dN5x4nS4OPknPI9JFg36fKxjqY0i1PSfFPv_J90"/>    
    <meta name="verify-reformal" content="f56f99fd7e087fb6ccb48ef2" />
    <title>Problem - 226E - Codeforces</title>
        <meta name="description" content="Codeforces. Programming competitions and contests, programming community" />
        <meta name="keywords" content="programming algorithm contest competition informatics olympiads c++ java graphs vkcup" />
    <meta name="robots" content="index, follow" />
    <HEAD><!--CombineResourcesFilter-->
    <LINK href="../../../../stat.codeforces.ru/favicon.png" rel="shortcut icon" type="image/png"/>
    <LINK href="../../../../stat.codeforces.ru/css/prettify.css" rel="stylesheet" type="text/css"/>
    <LINK charset="utf-8" href="../../../../codeforces.ru/static/combine/81d5459d81d074fc8d55b62d42856e2f_afb7247773e175c6194b5a4dbff89aeb.css" rel="stylesheet" type="text/css"/>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <LINK href="../../../../stat.codeforces.ru/markitup/skins/markitup/style.css" rel="stylesheet" type="text/css"/>
    <LINK href="../../../../stat.codeforces.ru/markitup/sets/markdown/style.css" rel="stylesheet" type="text/css"/>

    <SCRIPT charset="utf-8" src="../../../../yandex.st/share/share.js" type="text/javascript"> </SCRIPT>
    <LINK charset="utf-8" href="../../../../codeforces.ru/static/combine/eeae61f38a42b29407204616d93d8e8_aa3a566ac2a84e49a8e02f83d509fffe.css" rel="stylesheet" type="text/css"/>
    

    <!--[if IE]>
        <style>
            #sidebar {
                padding-left: 1em;
                margin: 1em 1em 1em 0;
            }
        </style>
    <![endif]-->
    
    <SCRIPT src="../../../../codeforces.ru/static/combine/92a6f5c66e500b5c1433eae7d3f371bb_5dc6637756ba9e44d6304b6267b72667.js" type="text/javascript"> </SCRIPT>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <!--/CombineResourcesFilter--></HEAD>
</head>
<body>


<!-- Copyright © 2008. Spidersoft Ltd -->
<style>
A.applink:hover {border: 2px dotted #DCE6F4;padding:2px;background-color:#ffff00;color:green;text-decoration:none}
A.applink       {border: 2px dotted #DCE6F4;padding:2px;color:#2F5BFF;background:transparent;text-decoration:none}
A.info          {color:#2F5BFF;background:transparent;text-decoration:none}
A.info:hover    {color:green;background:transparent;text-decoration:underline}
</style>
<div style='BORDER: 1px solid #DCE6F4; MARGIN-TOP: 20px; MARGIN-BOTTOM: 20px; MARGIN-LEFT: 5px; MARGIN-RIGHT: 5px; PADDING: 5px; BACKGROUND-COLOR: #eef8ff;line-height:180%; COLOR: #000000; font-family: Arial; font-size: 8pt; width=100%; FILTER: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr="#FFFFFFFF", EndColorStr="#F2F5FAFF");'>
This page was saved using <a class="applink" href="http://www.spidersoft.com"><b>WebZIP 7.1.2.1052</b></a> <a class="applink" href="http://www.spidersoft.com"><b>offline browser</b></a>  (Unregistered) on  11/09/12 16:28:26.<br>
<b>Address:</b> <a class="info" href="http://codeforces.com/problemset/problem/226/E">http://codeforces.com/problemset/problem/226/E</a><br>
<b>Title:</b> Problem - 226E - Codeforces &nbsp;&bull;&nbsp; <b>Size:</b> 20712<br></div>
<!-- /Copyright © 2008. Spidersoft Ltd -->


<!-- Codeforces javascripts. -->

    <script type="text/javascript">
        $(document).ready(function() {
    window.updateTypography = function () {
        $("div.ttypography code").addClass("tt");
        $("div.ttypography pre>code").addClass("prettyprint").removeClass("tt");
        $("div.ttypography table").addClass("bordertable");
        prettyPrint();
    }

    $.ajaxSetup({ scriptCharset: "utf-8" ,contentType: "application/x-www-form-urlencoded; charset=UTF-8" });
    window.updateTypography();

    Codeforces.signForms();

    $(".second-level-menu-list").lavaLamp({
        fx: "backout",
        speed: 1000
    });


    Codeforces.countdown();
    $("a[rel='photobox']").colorbox();


        });
    </script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-743380-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<div id="body">

<div id="header" style="position:relative;">
    <div style="float:left;">
            <a href="http://codeforces.com/"><img src="../../../../stat.codeforces.ru/images/codeforces-logo-with-upper-beta.png"/></a>
            <div style="position:absolute;left:147px;top:41px;">
                <a href="http://vk.com/" class="logo-href">Sponsored by <img style="position:relative;top:2px;" src="../../../../stat.codeforces.ru/images/vkontakte-tiny-en.png"/></a>
            </div>
    </div>
    <div class="lang-chooser">
        <div style="text-align: right;">
            <a href="http://codeforces.com/problemset/problem/226/?locale=en"><img src="../../../../stat.codeforces.ru/images/flags/24/gb.png" title="In English" alt="In English"/></a>
            <a href="http://codeforces.com/problemset/problem/226/?locale=ru"><img src="../../../../stat.codeforces.ru/images/flags/24/ru.png" title="ÐŸÐ¾-Ñ€ÑƒÑÑÐºÐ¸" alt="ÐŸÐ¾-Ñ€ÑƒÑÑÐºÐ¸"/></a>
        </div>
        <div>
                <a href="http://codeforces.com/enter">Enter</a>
                 | 
                <a href="http://codeforces.com/register">Register</a>
                
        </div>
    </div>
    <div style="font-size:0.8em;margin-top:0.25em;position:absolute;right:0;top:4.25em;">
    </div>
    <br style="clear: both;"/>
</div>

    <div class="roundbox menu-box" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
            <div class="menu-list-container">

<ul class="menu-list">
        <li class=""><a href="http://codeforces.com/">Home</a></li>
        <li class=""><a href="http://codeforces.com/contests">Contests</a></li>
        <li class=""><a href="http://codeforces.com/gyms">Gym</a></li>
        <li class="current"><a href="http://codeforces.com/problemset">Problemset</a></li>
        <li class=""><a href="http://codeforces.com/ratings">Rating</a></li>
        <li class=""><a href="http://codeforces.com/help">FAQ</a></li>
        <li class=""><a href="http://codeforces.com/croc2012">CROC 2012 <img class="icon" src="../../../../stat.codeforces.ru/images/icons/cup.png"/></a></li>
        <li class=""><a href="http://codeforces.com/bayan201213">Bayan 2012/13 <img class="icon" src="../../../../stat.codeforces.ru/images/icons/cup.png"/></a></li>
        <li class=""><a href="http://codeforces.com/croc-bmstu-2012">CROC-MBTU 2012 <img class="icon" src="../../../../stat.codeforces.ru/images/icons/cup.png"/></a></li>
</ul>
                <form action="/search">
                    <input class="search" name="query" value="Search by tag..."/>
                </form>
                <br style="clear: both;"/>
            </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $("input.search").focus(function() {
                var val = $(this).val();
                if (val.indexOf("...") > 0) {
                    $(this).val("");
                }
            });
        });
    </script>
        <br style="height:3em; clear: both;"/>
        <div style="position: relative;">
                <div id="sidebar">

    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <table class="rtable">
            <tbody>
                <tr>
                            <th class="left" style="width:100%;">Codeforces Round #140 (Div. 1)</th>
                </tr>
                    <tr>
                                <td class="left  dark" colspan="1"><span class='contest-state-phase'>Finished</span></td>
                    </tr>
                    <tr>
                                <td class="left bottom" colspan="1"><span class='contest-state-regular countdown' home='http://stat.codeforces.ru' noRedirection='true' textBeforeRedirect=''><center>
</center></span></td>
                    </tr>
            </tbody>
        </table>
    </div>


    <div class="roundbox sidebox" style="">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
        <div class="caption titled">&rarr; Problem tags
            <div class="top-links">
            </div>
        </div>
<div style="padding: 0.5em;">
    <div class="roundbox " style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
<span class="tag-box" style="font-size:12px;" title="Heaps, binary search trees, segment trees, hash tables, etc">
    data structures
</span>
    </div>
    <div class="roundbox " style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;">
            <div class="roundbox-lt">&nbsp;</div>
            <div class="roundbox-rt">&nbsp;</div>
            <div class="roundbox-lb">&nbsp;</div>
            <div class="roundbox-rb">&nbsp;</div>
<span class="tag-box" style="font-size:12px;" title="Trees">
    trees
</span>
    </div>
    <div style="clear:both;text-align:right;font-size:11px;">
            <span title="Please login into the Codeforces" class="notice">No tag edit access</span>
    </div>
</div>
    </div>

<form id="addTagForm" action="/data/problemTags" method="post" style="display:none;">
    <input name="action" type="hidden" value="addTag"/>
    <input name="problemId" type="hidden" value="1854"/>
    <input name="tagName" type="hidden" value=""/>
</form>

<form id="removeTagForm" action="/data/problemTags" method="post" style="display:none;">
    <input name="action" type="hidden" value="removeTag"/>
    <input name="problemId" type="hidden" value="1854"/>
    <input name="tagName" type="hidden" value=""/>
</form>

<script type="text/javascript">
    $(".tag-box img").click(function () {
        var tagName = $(this).attr("value");
        Codeforces.confirm("Are you sure you want to remove this tag?", function () {
            $("#removeTagForm input[name=tagName]").val(tagName);
            $("#removeTagForm").submit();
        }, function () {
        }, "Yes", "No");
    });

    $("#addTagLink").click(function () {
        $(this).hide();
        $("#addTagLabel").show();
        return false;
    });

    $("#addTagSelect").change(function () {
        var tagName = $(this).val();
        if (tagName === "") {
            $("#addTagLabel").hide();
            $("#addTagLink").show();
        } else {
            $("#addTagForm input[name=tagName]").val(tagName);
            $("#addTagForm").submit();
        }
    });
</script>

<style type="text/css">
#new-resource-form tr td {
padding-top: 0.5em;
}
#new-resource-form input:not([type="submit"]) {
font-size: 0.8em;
}
#new-resource-form select {
font-size: 0.8em;
}
</style>
<div class="roundbox sidebox sidebar-menu" style="">
<div class="roundbox-lt">&nbsp;</div>
<div class="roundbox-rt">&nbsp;</div>
<div class="caption titled">&rarr; Contest materials
<div class="top-links">
</div>
</div>
<ul>
<li>
<span>
<a href="http://codeforces.com/blog/entry/5357" title="Codeforces Round #140" target="_blank">Announcement</a>
</span>
<span style="float: right;">
<img class="delete-resource-link" resourceId="1250" resourceName="Codeforces Round #140"
resourceManual="true" src="../../../../stat.codeforces.ru/images/icons/close-10x10.png"
style="position: relative;bottom: -1px;left: 1px;cursor: pointer;"/>
</span>
<div style="clear: both;"></div>
</li>
</ul>
</div>                </div>
                <div id="content" class="content-with-sidebar">
                <div class="second-level-menu">
<ul class="second-level-menu-list">
    <li class="current"><a href="http://codeforces.com/problemset">Problems</a></li>
    <li><a href="http://codeforces.com/problemset/submit">Submit</a></li>
    <li><a href="http://codeforces.com/problemset/status">Status</a></li>
    <li><a href="http://codeforces.com/problemset/standings">Standings</a></li>
    <li><a href="http://codeforces.com/problemset/customtest">Custom test</a></li>
</ul>
</div>

<div class="ttypography"><div class="problem-statement"><div class="header"><div class="title">E. Noble Knight's Path</div><div class="time-limit"><div class="property-title">time limit per test</div>4 seconds</div><div class="memory-limit"><div class="property-title">memory limit per test</div>256 megabytes</div><div class="input-file"><div class="property-title">input</div>standard input</div><div class="output-file"><div class="property-title">output</div>standard output</div></div><div><p>In Berland each feudal owns exactly one castle and each castle belongs to exactly one feudal.</p><p>Each feudal, except one (the King) is subordinate to another feudal. A feudal can have any number of vassals (subordinates).</p><p>Some castles are connected by roads, it is allowed to move along the roads in both ways. Two castles have a road between them if and only if the owner of one of these castles is a direct subordinate to the other owner.</p><p>Each year exactly one of these two events may happen in Berland.</p><p><ol> <li> The barbarians attacked castle <span class="tex-span"><i>c</i></span>. The interesting fact is, the barbarians never attacked the same castle twice throughout the whole Berlandian history. </li><li> A noble knight sets off on a journey from castle <span class="tex-span"><i>a</i></span> to castle <span class="tex-span"><i>b</i></span> (provided that on his path he encounters each castle not more than once). </li></ol></p><p>Let's consider the second event in detail. As the journey from <span class="tex-span"><i>a</i></span> to <span class="tex-span"><i>b</i></span> is not short, then the knight might want to stop at a castle he encounters on his way to have some rest. However, he can't stop at just any castle: his nobility doesn't let him stay in the castle that has been desecrated by the enemy's stench. A castle is desecrated if and only if it has been attacked after the year of <span class="tex-span"><i>y</i></span>. So, the knight chooses the <span class="tex-span"><i>k</i></span>-th castle he encounters, starting from <span class="tex-span"><i>a</i></span> (castles <span class="tex-span"><i>a</i></span> and <span class="tex-span"><i>b</i></span> aren't taken into consideration), that hasn't been attacked in years from <span class="tex-span"><i>y</i>â€‰+â€‰1</span> till current year.</p><p>The knights don't remember which castles were attacked on what years, so he asked the court scholar, aka you to help them. You've got a sequence of events in the Berland history. Tell each knight, in what city he should stop or else deliver the sad news â€” that the path from city <span class="tex-span"><i>a</i></span> to city <span class="tex-span"><i>b</i></span> has less than <span class="tex-span"><i>k</i></span> cities that meet his requirements, so the knight won't be able to rest.</p></div><div class="input-specification"><div class="section-title">Input</div><p>The first input line contains integer <span class="tex-span"><i>n</i></span> <span class="tex-span">(2â€‰â‰¤â€‰<i>n</i>â€‰â‰¤â€‰10<sup class="upper-index">5</sup>)</span> â€” the number of feudals. </p><p>The next line contains <span class="tex-span"><i>n</i></span> space-separated integers: the <span class="tex-span"><i>i</i></span>-th integer shows either the number of the <span class="tex-span"><i>i</i></span>-th feudal's master, or a <span class="tex-span">0</span>, if the <span class="tex-span"><i>i</i></span>-th feudal is the King. </p><p>The third line contains integer <span class="tex-span"><i>m</i></span> <span class="tex-span">(1â€‰â‰¤â€‰<i>m</i>â€‰â‰¤â€‰10<sup class="upper-index">5</sup>)</span> â€” the number of queries.</p><p>Then follow <span class="tex-span"><i>m</i></span> lines that describe the events. The <span class="tex-span"><i>i</i></span>-th line (the lines are indexed starting from <span class="tex-span">1</span>) contains the description of the event that occurred in year <span class="tex-span"><i>i</i></span>. Each event is characterised by type <span class="tex-span"><i>t</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span">(1â€‰â‰¤â€‰<i>t</i><sub class="lower-index"><i>i</i></sub>â€‰â‰¤â€‰2)</span>. The description of the first type event looks as two space-separated integers <span class="tex-span"><i>t</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span"><i>c</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span">(<i>t</i><sub class="lower-index"><i>i</i></sub>â€‰=â€‰1;Â 1â€‰â‰¤â€‰<i>c</i><sub class="lower-index"><i>i</i></sub>â€‰â‰¤â€‰<i>n</i>)</span>, where <span class="tex-span"><i>c</i><sub class="lower-index"><i>i</i></sub></span> is the number of the castle that was attacked by the barbarians in the <span class="tex-span"><i>i</i></span>-th year. The description of the second type contains five space-separated integers: <span class="tex-span"><i>t</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span"><i>a</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span"><i>b</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span"><i>k</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span"><i>y</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span">(<i>t</i><sub class="lower-index"><i>i</i></sub>â€‰=â€‰2;Â 1â€‰â‰¤â€‰<i>a</i><sub class="lower-index"><i>i</i></sub>,â€‰<i>b</i><sub class="lower-index"><i>i</i></sub>,â€‰<i>k</i><sub class="lower-index"><i>i</i></sub>â€‰â‰¤â€‰<i>n</i>;Â <i>a</i><sub class="lower-index"><i>i</i></sub>â€‰â‰ â€‰<i>b</i><sub class="lower-index"><i>i</i></sub>;Â 0â€‰â‰¤â€‰<i>y</i><sub class="lower-index"><i>i</i></sub>â€‰&lt;â€‰<i>i</i></span>), where <span class="tex-span"><i>a</i><sub class="lower-index"><i>i</i></sub></span> is the number of the castle from which the knight is setting off, <span class="tex-span"><i>b</i><sub class="lower-index"><i>i</i></sub></span> is the number of the castle to which the knight is going, <span class="tex-span"><i>k</i><sub class="lower-index"><i>i</i></sub></span> and <span class="tex-span"><i>y</i><sub class="lower-index"><i>i</i></sub></span> are the <span class="tex-span"><i>k</i></span> and <span class="tex-span"><i>y</i></span> from the second event's description.</p><p>You can consider the feudals indexed from 1 to <span class="tex-span"><i>n</i></span>. It is guaranteed that there is only one king among the feudals. It is guaranteed that for the first type events all values <span class="tex-span"><i>c</i><sub class="lower-index"><i>i</i></sub></span> are different.</p></div><div class="output-specification"><div class="section-title">Output</div><p>For each second type event print an integer â€” the number of the castle where the knight must stay to rest, or -1, if he will have to cover the distance from <span class="tex-span"><i>a</i><sub class="lower-index"><i>i</i></sub></span> to <span class="tex-span"><i>b</i><sub class="lower-index"><i>i</i></sub></span> without a rest. Separate the answers by whitespaces.</p><p>Print the answers in the order, in which the second type events are given in the input.</p></div><div class="sample-tests"><div class="section-title">Sample test(s)</div><div class="sample-test"><div class="input"><div class="title">Input</div><pre>3<br />0 1 2<br />5<br />2 1 3 1 0<br />1 2<br />2 1 3 1 0<br />2 1 3 1 1<br />2 1 3 1 2<br /></pre></div><div class="output"><div class="title">Output</div><pre>2<br />-1<br />-1<br />2<br /></pre></div><div class="input"><div class="title">Input</div><pre>6<br />2 5 2 2 0 5<br />3<br />2 1 6 2 0<br />1 2<br />2 4 5 1 0<br /></pre></div><div class="output"><div class="title">Output</div><pre>5<br />-1<br /></pre></div></div></div><div class="note"><div class="section-title">Note</div><p>In the first sample there is only castle <span class="tex-span">2</span> on the knight's way from castle <span class="tex-span">1</span> to castle <span class="tex-span">3</span>. When the knight covers the path <span class="tex-span">1â€‰-â€‰3</span> for the first time, castle <span class="tex-span">2</span> won't be desecrated by an enemy and the knight will stay there. In the second year the castle <span class="tex-span">2</span> will become desecrated, so the knight won't have anywhere to stay for the next two years (as finding a castle that hasn't been desecrated from years <span class="tex-span">1</span> and <span class="tex-span">2</span>, correspondingly, is important for him). In the fifth year the knight won't consider the castle <span class="tex-span">2</span> desecrated, so he will stay there again.</p></div></div></div>            </div>
        </div>
          <br style="clear:both;"/> 
          <div id="footer">
               <div><a href="http://codeforces.com/">Codeforces</a> (c) Copyright 2010-2012 Mike Mirzayanov</div>
               <div>The only programming contests Web 2.0 platform</div>
               
               <div>Server time: 11/09/2012 12:27PM.</div>
          </div>
    <script type="text/javascript">
        $(document).ready(function() {
            Codeforces.focusOnError();
        });
    </script>
</div>    
</body>                                       
</html>                                       
